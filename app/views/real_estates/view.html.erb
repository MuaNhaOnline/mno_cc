<% content_for :stylesheets do %>
	<link rel="stylesheet" type="text/css" href="/assets/real_estates/view.css">
<% end %>

<% content_for :javascripts do %>
	<script type="text/javascript" src='http://maps.google.com/maps/api/js?sensor=false&libraries=places'></script>
	<script type="text/javascript" src="/assets/shared/locationpicker.js"></script>
	<script type="text/javascript" src="/assets/real_estates/view.js"></script>
	<script type="text/javascript">
		realEstateId = <%= @re.id %>;
	</script>
<% end %>

<%
=begin
	@re
=end

	@_title = @re.name
	@_description = "#{@re.name}. #{@re.title}"

	@_main_navigator = {
		background: '/assets/shared/main_navigator/main_2.jpeg',
		list: [
			{
				url: '/bat-dong-san',
				text: 'Bất động sản'
			},
			{
				url: "/bat-dong-san/#{@re.full_slug}",
				text: @re.title
			}
		]
	}

	@_hide_search_box = true

	# Register info
	register_info = nil
	if signed?
		register_info = ContactRequest.where(user_type: 'user', user_id: current_user.id, request_type: 'register', object_type: 'real_estate', object_id: @re.id).first
	else
		if left_contact?
			register_info = ContactRequest.where(user_type: 'contact_user', user_id: current_left_contact.id, request_type: 'register', object_type: 'real_estate', object_id: @re.id).first
		end
	end

	if register_info.blank?
		register_info = ContactRequest.new request_type: 'register', object_type: 'real_estate', object_id: @re.id
	end
%>

<div class="container no-horizontal-padding">
	<div class="row">

		<!-- Images -->

			<% if @re.images.present? %>
				<div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
					<section class="images-container">
						<section class="image">
							<img src="<%= @re.images[0].image.url(:slide) %>" />
						</section>
						<section class="circle-paging">
							<% @re.images.each_with_index do |re_image, index| %>
								<%
									data = {
										original: re_image.image.url,
										slide: re_image.image.url(:slide)
									}
								%>
								<a class="<%= 'active' if index == 0 %>" data-data="<%= data.to_json %>">
									<span></span>
								</a>
							<% end %>
						</section>
					</section>
				</div>
			<% end %>

		<!-- / Images -->

		<!-- Info -->

			<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="float: right">
				<section class="infos-container">
					<article class="content">
						<section class="title">
							<h2>
								<%= @re.title %>
							</h2>						
						</section>
						<section class="price">
							<% if @re.fields.include? :sell_price %>
								<section class="sell-price-text">
									<%= @re.display_sell_price %>
								</section>
							<% end %>
							<% if @re.fields.include? :rent_price %>
								<section class="rent-price-text">
									<%= @re.display_rent_price %>
								</section>
							<% end %>
						</section>
						<section class="infos">
							<div class="row no-horizontal-padding">
								<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
									<section class="info-item">
										<section class="icon">
											<span class="ico-location"></span>
										</section>
										<section class="text">
											<section class="name">
												Địa chỉ <span class="ico-info"></span>
											</section>
											<section class="value">
												<%= @re.display_address %>
											</section>
										</section>
										<section class="more">
											<% if @re.fields.include? :building_name %>
												<article class="text">
													<span class="name">
														Tòa nhà
													</span>
													<span class="value">
														<%= "Tầng #{@re.floor_number}" if @re.fields.include? :floor_number %> <%= @re.building_name %>
													</span>
												</article>
											<% end %>
											<% if @re.fields.include?(:is_alley) && @re.fields.include?(:street_type) %>
												<article class="text">
													<span class="name">
														Vị trí
													</span>
													<span class="value">
														<%= @re.display_is_alley %> - <%= @re.display_street_type %>
													</span>
												</article>
											<% end %>
										</section>
									</section>
								</div>
								<div class="hidden"></div>
								<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
									<article class="info-item">
										<section class="icon">
											<span class="ico-hash"></span>
										</section>
										<section class="text">
											<section class="name">
												Mã
											</section>
											<section class="value">
												<%= @re.display_id %>
											</section>
										</section>
									</article>
								</div>
								<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
									<article class="info-item">
										<section class="icon">
											<span class="ico-clock"></span>
										</section>
										<section class="text">
											<section class="name">
												Thời gian đăng
											</section>
											<section class="value" aria-time="<%= @re.created_at %>">
											</section>
										</section>
									</article>
								</div>
								<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
									<article class="info-item">
										<section class="icon">
											<span class="ico-home"></span>
										</section>
										<section class="text">
											<section class="name">
												Loại
											</section>
											<section class="value">
												<%= @re.display_real_estate_type %>
											</section>
										</section>
									</article>
								</div>
								<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
									<article class="info-item">
										<section class="icon">
											<span class="ico-area"></span>
										</section>
										<section class="text">
											<section class="name">
												Diện tích <span class="ico-info"></span>
											</section>
											<section class="value">
												<%= @re.display_area %><span class="unit">m<sup>2</sup></span>
											</section>
										</section>
										<section class="more">
											<% if @re.fields.include?(:width_x) && @re.display_width_x.present? && @re.fields.include?(:width_y) && @re.display_width_y.present?%>
												<article class="text">
													<span class="name">
														Kích thước
													</span>
													<span class="value">
														<%= @re.display_width_x %><span class="unit">x</span><%= @re.display_width_y %><span class="unit">m</span>
													</span>
													<% if @re.fields.include?(:shape) && @re.display_shape(false).present? %>
														<span class="value">
															<span class="unit">-</span> <%= @re.display_shape(false) %> <%= @re.display_shape_width %><span class="unit">m</span>
														</span>
													<% end %>
												</article>
											<% end %>
											<% if @re.fields.include? :campus_area %>
												<article class="text">
													<span class="name">
														DT khuôn viên
													</span>
													<span class="value">
														<%= @re.display_campus_area %><span class="unit">m<sup>2</sup></span>
													</span>
												</article>
											<% end %>
											<% if @re.fields.include? :constructional_area %>
												<article class="text">
													<span class="name">
														DT xây dựng
													</span>
													<span class="value">
														<%= @re.display_constructional_area %><span class="unit">m<sup>2</sup></span>
													</span>
												</article>
											<% end %>
											<% if @re.fields.include? :using_area %>
												<article class="text">
													<span class="name">
														DT sử dụng
													</span>
													<span class="value">
														<%= @re.display_using_area %><span class="unit">m<sup>2</sup></span>
													</span>
												</article>
											<% end %>
										</section>
									</article>
								</div>
								<% if @re.fields.include? :bedroom_number %>
									<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
										<article class="info-item">
											<section class="icon">
												<span class="ico-bedroom"></span>
											</section>
											<section class="text">
												<section class="name">
													Phòng ngủ
												</section>
												<section class="value">
													<%= @re.display_bedroom %>
												</section>
											</section>
										</article>
									</div>
								<% end %>
								<% if @re.fields.include? :restroom_number %>
									<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
										<article class="info-item">
											<section class="icon">
												<span class="ico-restroom"></span>
											</section>
											<section class="text">
												<section class="name">
													Phòng tắm
												</section>
												<section class="value">
													<%= @re.display_restroom %>
												</section>
											</section>
										</article>
									</div>
								<% end %>
								<% if @re.fields.include? :direction %>
									<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
										<article class="info-item">
											<section class="icon">
												<span class="ico-compass"></span>
											</section>
											<section class="text">
												<section class="name">
													Hướng
												</section>
												<section class="value">
													<%= @re.display_direction %>
												</section>
											</section>
										</article>
									</div>
								<% end %>
								<% if @re.fields.include? :legal_record_type %>
									<div class="col-xs-6 col-sm-3 col-md-6 col-lg-6">
										<article class="info-item">
											<section class="icon">
												<span class="ico-newspaper"></span>
											</section>
											<section class="text">
												<section class="name">
													Giấy tờ <span class="ico-info"></span>
												</section>
												<section class="value">
													<%= @re.display_legal_record_type %>
												</section>
											</section>
											<section class="more">
												<% if @re.fields.include? :constructional_level %>
													<article class="text">
														<span class="name">
															Loại
														</span>
														<span class="value">
															<%= @re.display_constructional_level %>
														</span>
													</article>
												<% end %>
												<% if @re.fields.include? :constructional_quality %>
													<article class="text">
														<span class="name">
															Tình trạng
														</span>
														<span class="value">
															<%= @re.display_constructional_quality %>
														</span>
													</article>
												<% end %>
												<% if @re.fields.include? :planning_status_type %>
													<article class="text">
														<span class="name">
															Tình trạng quy hoạch
														</span>
														<span class="value">
															<%= @re.display_planning_status_type %>
														</span>
													</article>
												<% end %>
											</section>
										</article>
									</div>
								<% end %>
							</div>
						</section>
					</article>
				</section>
				<section class="buttons-container">
					<a id="re_register" class="register btn btn-orange">
						<% if register_info.new_record? %>
							Đăng ký
						<% else %>
							Đã đăng ký
						<% end %>
					</a>					
					<a id="re_favorite" class="btn" <%= 'data-actived' if @re.is_current_user_favorite %>>
						Quan tâm
					</a>
				</section>
			</div>

		<!-- / Info -->

		<!-- Description -->

			<div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
				<section class="description-container">
					<article class="box">
						<section class="box-header">
							<article class="box-title">
								Mô tả
							</article>
						</section>
						<section class="box-body">
							<%= @re.display_description %>
						</section>
					</article>
					<article class="box">
						<section class="box-header">
							<article class="box-title">
								Bản đồ vị trí
							</article>
						</section>
						<section class="box-body">
							<section class="address">
								<span class="name">
									<span class="ico-location"></span> Địa chỉ
								</span>
								<span class="value">
									<%= @re.display_address %>
								</span>							
							</section>
							<section id="map" tabindex="0" style="outline: 0; height: 300px; width: 100%" data-lat="<%= @re.lat %>" data-long="<%= @re.long %>">
								
							</section>
						</section>
					</article>
					<% if (@re.fields.include?(:property_utility) && @re.property_utilities.present?) || (@re.fields.include?(:region_utility) && @re.region_utilities.present?)  %>
						<article class="box">
							<section class="box-header">
								<article class="box-title">
									Tiện ích
								</article>
							</section>
							<section class="box-body">
								<% if @re.fields.include?(:property_utility) && @re.property_utilities.present? %>
									<article class="content-box">
										<section class="content-box-header">
											<aricle class="content-box-title">
												Tiện ích bất động sản
											</aricle>
										</section>
										<section class="content-box-body">
											<article class="items-list">
												<% @re.property_utilities.each do |utility| %>
													<article class="item">
														<%= utility.display_name %>
													</article>
												<% end %>
											</article>
										</section>
									</article>
								<% end %>
								<% if @re.fields.include?(:region_utility) && @re.region_utilities.present? %>
									<article class="content-box">
										<section class="content-box-header">
											<aricle class="content-box-title">
												Tiện ích khu vực
											</aricle>
										</section>
										<section class="content-box-body">
											<article class="items-list">
												<% @re.region_utilities.each do |utility| %>
													<article class="item">
														<%= utility.display_name %>
													</article>
												<% end %>
											</article>
										</section>
									</article>
								<% end %>
							</section>
						</article>
					<% end %>
					<% if (@re.fields.include?(:advantage) && @re.advantages.present?) || (@re.fields.include?(:disadvantage) && @re.disadvantages.present?) %>
						<article class="box">
							<section class="box-header">
								<article class="box-title">
									Đánh giá
								</article>
							</section>
							<section class="box-body">
								<% if @re.fields.include?(:advantage) && @re.advantages.present? %>
									<article class="content-box">
										<section class="content-box-header">
											<aricle class="content-box-title">
												Điểm tốt
											</aricle>
										</section>
										<section class="content-box-body">
											<article class="items-list">
												<% @re.advantages.each do |advantage| %>
													<article class="item">
														<%= advantage.display_name %>
													</article>
												<% end %>
											</article>
										</section>
									</article>
								<% end %>
								<% if @re.fields.include?(:disadvantage) && @re.disadvantages.present? %>
									<article class="content-box">
										<section class="content-box-header">
											<aricle class="content-box-title">
												Điểm xấu
											</aricle>
										</section>
										<section class="content-box-body">
											<article class="items-list">
												<% @re.disadvantages.each do |disadvantage| %>
													<article class="item">
														<%= disadvantage.display_name %>
													</article>
												<% end %>
											</article>
										</section>
									</article>
								<% end %>
							</section>
						</article>
					<% end %>
				</section>
			</div>

		<!-- / Description -->

		<!-- Contact -->

			<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="float: right">
				<section class="contact-container">
					<article class="box">
						<section class="box-header">
							<article class="box-title">
								Liên hệ
							</article>
						</section>
						<section class="box-body">
							<article class="user-info">
								<% if @re.user.present? %>
									<section class="avatar">
										<%= user_avatar @re.user, style: :big %>
									</section>
									<section class="info">
										<article class="text name">
											<%= @re.user.full_name %>
										</article>
										<% if @re.user.email.present? %>
											<article class="text">
												<span class="icon ico-envelop"></span>
												<%= @re.user.email %>
											</article>
										<% end %>
										<% if @re.user.phone_number.present? %>
											<article class="text" style="color: #FFC834">
												<span class="icon ico-phone"></span>
												<%= @re.user.phone_number %>
											</article>
										<% end %>
										<% if @re.user.address.present? %>
											<article class="text">
												<span class="icon ico-location"></span>
												<%= @re.user.address %>
											</article>
										<% end %>
									</section>
								<% else %>
									<section class="avatar">
										<img src="/assets/users/big/default.png" alt="<%= @re.user_full_name %>">
									</section>
									<section class="info">
										<article class="text name">
											<%= @re.user_full_name %>
										</article>
										<% if @re.user_email.present? %>
											<article class="text">
												<span class="icon ico-envelop"></span>
												<%= @re.user_email %>
											</article>
										<% end %>
										<% if @re.user_phone_number.present? %>
											<article class="text">
												<span class="icon ico-phone"></span>
												<%= @re.user_phone_number %>
											</article>
										<% end %>
									</section>
								<% end %>
							</article>
							<article class="contact-request">
								<% if register_info.new_record? %>
									<article class="callout">
										Hãy để lại lời nhắn cho chúng tôi nếu bạn có bất cứ nhu cầu gì.
									</article>
								<% end %>
								<form id="register_form" class="form" 
									data-request_info="<%= register_info.to_json only: [:id, :request_type, :object_type, :object_id, :message] %>" 
									<%= "data-contact_info='#{current_left_contact.to_json only: [:id, :email, :phone_number]}'".html_safe unless signed? %>
								>
									<input data-toggled-element="default-contact" type="hidden" name="request[id]" value="" />
									<input type="hidden" name="request[request_type]" value="" />
									<input type="hidden" name="request[object_type]" value="" />
									<input type="hidden" name="request[object_id]" value="" />
									<article class="form-group text-center">
										<button class="btn btn-orange" style="padding-left: 25px; padding-right: 25px">
											Gửi
										</button>
									</article>
									<article class="form-group">
										<textarea class="form-control" placeholder="Lời nhắn" name="request[message]"></textarea>
									</article>
									<% unless signed? %>
										<% if left_contact? %>
											<div class="row" data-toggled-element="default-contact">
												<input type="hidden" name="contact[id]" value="" />
												<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
													<input data-nonvalid class="form-control" name="contact[default_email]" value="" readonly="true" tabindex="-1" />
												</article>
												<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
													<input data-nonvalid class="form-control" name="contact[default_phone_number]" value="" readonly="true" tabindex="-1" />
												</article>
												<article class="form-group col-xs-12 col-sm-12 col-md-12 col-lg-12 text-right">
													<div class="radio margin-0">
														<label>
															<input data-nonvalid class="input-toggle sr-only" data-on="new-contact" data-off="default-contact" type="radio" name="use_default_contact" value="" />
															<a style="color: inherit;">Không phải tôi</a>
														</label>
													</div>
												</article>
											</div>
											<div class="row off" data-toggled-element="new-contact">
												<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
													<input data-constraint="required email" class="form-control" name="contact[email]" />
												</article>
												<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
													<input data-constraint="required phone" class="form-control" name="contact[phone_number]" />
												</article>
												<article class="form-group col-xs-12 col-sm-12 col-md-12 col-lg-12 text-right">
													<div class="radio margin-0">
														<label>
															<input data-nonvalid class="input-toggle sr-only" data-on="default-contact" data-off="new-contact" type="radio" name="use_default_contact" value="t" checked />
															<a style="color: inherit;">Quay lại</a>
														</label>
													</div>
												</article>
											</div>
										<% else %>
											<div class="row">
												<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
													<input data-constraint="required email" class="form-control" placeholder="Email" name="contact[email]" />
												</article>
												<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
													<input data-constraint="required phone" class="form-control" placeholder="Điện thoại" name="contact[phone_number]" />
												</article>
											</div>
										<% end %>
									<% end %>
								</form>
							</article>
						</section>
					</article>
				</section>
			</div>

		<!-- / Contact -->

	</div>

	<!-- Relative real-estate -->
	
		<article class="box box-transparent">
			<section class="box-header">
				<h2 class="box-title">
					Bất động sản liên quan
				</h2>
			</section>
			<section class="box-body">
				<%
					res = RealEstate.search_with_params.limit(6)
				%>
				<%= render partial: '/real_estates/items_list', locals: { res: res } %>
			</section>
		</article>
	
	<!-- / Relative real-estate -->
</div>

<article class="box" aria-popupcontent="re_register">
	<section class="box-header">
		<span class="box-title">
			Đăng ký sản phẩm
		</span>
	</section>
	<section class="box-body">
		<form class="form">
			<input data-toggled-element="default-contact" type="hidden" name="request[id]" value="" />
			<input type="hidden" name="request[request_type]" value="" />
			<input type="hidden" name="request[object_type]" value="" />
			<input type="hidden" name="request[object_id]" value="" />
			<article class="callout">
				Hãy để lại lời nhắn của bạn, chúng tôi sẽ phục vụ bạn trong thời gian sớm nhất.
			</article>
			<article class="form-group">
				<label class="control-label">
					Lời nhắn
				</label>
				<textarea class="form-control" name="request[message]" placeholder="Bạn đang có yêu cầu gì?"></textarea>
			</article>
			<% unless signed? %>
				<% if left_contact? %>
					<div class="row" data-toggled-element="default-contact">
						<input type="hidden" name="contact[id]" value="" />
						<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<input data-nonvalid class="form-control" name="contact[default_email]" value="" readonly="true" tabindex="-1" />
						</article>
						<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<input data-nonvalid class="form-control" name="contact[default_phone_number]" value="" readonly="true" tabindex="-1" />
						</article>
						<article class="form-group col-xs-12 col-sm-12 col-md-12 col-lg-12 text-right">
							<div class="radio margin-0">
								<label>
									<input data-nonvalid class="input-toggle sr-only" data-on="new-contact" data-off="default-contact" type="radio" name="use_default_contact" value="" />
									<a style="color: inherit;">Không phải tôi</a>
								</label>
							</div>
						</article>
					</div>
					<div class="row off" data-toggled-element="new-contact">
						<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<input data-constraint="required email" class="form-control" placeholder="Email" name="contact[email]" />
						</article>
						<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<input data-constraint="required phone" class="form-control" placeholder="Điện thoại" name="contact[phone_number]" />
						</article>
						<article class="form-group col-xs-12 col-sm-12 col-md-12 col-lg-12 text-right">
							<div class="radio margin-0">
								<label>
									<input data-nonvalid class="input-toggle sr-only" data-on="default-contact" data-off="new-contact" type="radio" name="use_default_contact" value="t" checked />
									<a style="color: inherit;">Quay lại</a>
								</label>
							</div>
						</article>
					</div>
				<% else %>
					<div class="row">
						<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<input data-constraint="required email" class="form-control" placeholder="Email" name="contact[email]" />
						</article>
						<article class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<input data-constraint="required phone" class="form-control" placeholder="Điện thoại" name="contact[phone_number]" />
						</article>
					</div>
				<% end %>
			<% end %>
			<article class="form-group text-right">
				<button class="btn btn-green">
					Đăng ký
				</button>
				<button type="button" aria-click="close-popup" class="btn">
					Hủy
				</button>
			</article>
		</form>
	</section>
</article>